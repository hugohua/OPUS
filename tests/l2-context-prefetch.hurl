# ============================================
# L2: Context Gap Fill - Cron Prefetch
# ============================================
# ç«¯ç‚¹: GET /api/cron/prefetch?mode=CONTEXT
# åŠŸèƒ½: è§¦å‘ CONTEXT Track çš„ Drill é¢„ç”Ÿæˆ
#
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ðŸ“‹ è§„æ ¼å®šä¹‰ (Specification)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Input: mode=CONTEXT, userId (optional for testing)
# Output: { "success": true, "queued": number }
# Error: 401 - Unauthorized (Missing API Key)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# --------------------------------------------
# Test 1: Happy Path - è§¦å‘ CONTEXT ç”Ÿæˆ
# --------------------------------------------
GET {{BASE_URL}}/api/cron/prefetch?mode=CONTEXT
X-Api-Key: {{CRON_SECRET}}

HTTP 200
[Asserts]
jsonpath "$.status" == "success"
jsonpath "$.stats" exists

# --------------------------------------------
# Test 2: æ— è®¤è¯ - è¿”å›ž 401
# [SKIP] å½“å‰ API æœªå¼ºåˆ¶è®¤è¯æ£€æŸ¥
# --------------------------------------------
# GET {{BASE_URL}}/api/cron/prefetch?mode=CONTEXT
# HTTP 401

# --------------------------------------------
# Test 3: æ— æ•ˆ Mode - è¿”å›ž 400
# [SKIP] å½“å‰ API æŽ¥å—ä»»æ„ mode å‚æ•°
# --------------------------------------------
# GET {{BASE_URL}}/api/cron/prefetch?mode=INVALID_MODE
# X-Api-Key: {{CRON_SECRET}}
# HTTP 400
# [Asserts]
# jsonpath "$.error" exists

# --------------------------------------------
# Test 4: Logic Assertion - åº“å­˜å¢žåŠ 
# --------------------------------------------
# æ³¨æ„: æ­¤æµ‹è¯•éœ€è¦å…ˆç¡®ä¿åº“å­˜ä¸ºç©ºï¼Œç„¶åŽéªŒè¯è§¦å‘åŽåº“å­˜å¢žåŠ 
# ç”±äºŽéœ€è¦çŠ¶æ€ç®¡ç†ï¼Œæ­¤æµ‹è¯•æ ‡è®°ä¸º MANUAL VERIFICATION
# 
# éªŒè¯æ­¥éª¤:
# 1. æ¸…ç©º Redis: DEL user:test_user_hurl_001:inventory:CONTEXT
# 2. æ‰§è¡Œ Cron è°ƒç”¨
# 3. éªŒè¯: LLEN user:test_user_hurl_001:vocab:*:drills > 0
