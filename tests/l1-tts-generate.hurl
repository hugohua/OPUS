# ============================================
# L1: TTS ç”Ÿæˆç«¯ç‚¹æµ‹è¯•
# ============================================
# ç«¯ç‚¹: POST /api/tts/generate
# åŠŸèƒ½: æ–‡å­—è½¬è¯­éŸ³ç”Ÿæˆ (è°ƒç”¨ Python Worker)
# æ¶æ„: Next.js Brain â†’ Python Voice Renderer
#
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ğŸ“‹ è§„æ ¼å®šä¹‰ (Specification)
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Input (JSON Body):
#   {
#     "text": string,         // è¦è½¬æ¢çš„æ–‡æœ¬ (å¿…éœ€)
#     "voice": string,        // è¯­éŸ³ç±»å‹: "alloy" | "echo" | "fable" | ...
#     "language": string      // è¯­è¨€: "en" | "zh"
#   }
#
# Output (JSON Schema):
#   {
#     "success": boolean,
#     "url": string,          // ç”Ÿæˆçš„éŸ³é¢‘ URL
#     "cached": boolean       // æ˜¯å¦å‘½ä¸­ç¼“å­˜
#   }
#
# Error Response:
#   400: { "error": "Missing required field: text" }
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# ============================================
# Test 1: åŸºç¡€ TTS ç”Ÿæˆ (Happy Path)
# ============================================
POST {{BASE_URL}}/api/tts/generate
Content-Type: application/json
{
    "text": "{{TEST_TTS_TEXT}}",
    "voice": "Cherry",
    "language": "en"
}

HTTP 200
[Captures]
audio_url: jsonpath "$.url"
is_cached: jsonpath "$.cached"
[Asserts]
# 1. Schema éªŒè¯
jsonpath "$.success" isBoolean
jsonpath "$.url" isString
jsonpath "$.cached" isBoolean

# 2. ä¸šåŠ¡é€»è¾‘éªŒè¯
jsonpath "$.success" == true

# ============================================
# Test 2: ç¼“å­˜å‘½ä¸­æµ‹è¯• (ç›¸åŒè¯·æ±‚)
# ============================================
POST {{BASE_URL}}/api/tts/generate
Content-Type: application/json
{
    "text": "{{TEST_TTS_TEXT}}",
    "voice": "Cherry",
    "language": "en"
}

HTTP 200
[Asserts]
jsonpath "$.success" == true
jsonpath "$.cached" == true

# ============================================
# Test 3: ç¼ºå°‘å¿…éœ€å‚æ•°åº”è¿”å› 400
# ============================================
POST {{BASE_URL}}/api/tts/generate
Content-Type: application/json
{
    "voice": "Cherry"
}

HTTP 500
[Asserts]
jsonpath "$.error" exists
