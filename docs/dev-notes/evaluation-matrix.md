# Opus Evaluation Matrix (è¯„ä¼°çŸ©é˜µ)

> æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0
> æœ€åæ›´æ–°ï¼š2026-01-31
> çŠ¶æ€ï¼šDraft

## 0. æ ¸å¿ƒæŒ‘æˆ˜

Opus æ˜¯ä¸€ä¸ª **åŒé‡éç¡®å®šæ€§ç³»ç»Ÿ**ï¼š

| éç¡®å®šæ€§æ¥æº | æˆå›  | å½±å“ |
|--------------|------|------|
| **é€»è¾‘éç¡®å®šæ€§** | FSRS ç®—æ³• â†’ æ¯ç”¨æˆ·æ¯å¤©é¢˜ç›®ä¸åŒ | ä¼ ç»Ÿ Unit Test æ— æ³•è¦†ç›– |
| **å†…å®¹éç¡®å®šæ€§** | LLM æ¦‚ç‡ç”Ÿæˆ â†’ åŒé¢˜æ¯æ¬¡æ–‡æœ¬ä¸åŒ | æ— æ³•ç”¨ Snapshot Test å›å½’ |

**è§£å†³æ–¹æ¡ˆ**ï¼šæ„å»ºä¸‰ç»´è¯„ä¼°çŸ©é˜µ (Logic Ã— Quality Ã— Stability)ã€‚

---

## 1. ç»´åº¦ä¸€ï¼šé€»è¾‘æ­£ç¡®æ€§ (Logic)

> ç›®æ ‡ï¼šç¡®ä¿è°ƒåº¦å™¨æ²¡æœ‰å‘ç–¯ï¼Œç¡®ä¿"è¯¥å‡ºç°çš„å‡ºç°äº†ï¼Œä¸è¯¥å‡ºç°çš„è¢«æ‹¦ä½äº†"ã€‚

### 1.1 æµ‹è¯•ç­–ç•¥ï¼šTime-Travel Simulation (æ—¶é—´æ—…è¡Œæ¨¡æ‹Ÿ)

ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬æ¨¡æ‹Ÿè™šæ‹Ÿç”¨æˆ· 30 å¤©å­¦ä¹ å†ç¨‹ï¼Œ**ä¸æ¶‰åŠçœŸå® LLM è°ƒç”¨** (Mock æ•°æ®)ã€‚

### 1.2 æ ¸å¿ƒæµ‹è¯•ç”¨ä¾‹

#### Case A: å¤šè½¨éš”ç¦»æµ‹è¯• (Multi-Track Isolation)

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ“ä½œ** | è®¾ç½® `Strategy` çš„ Visual Track = `Master` (S=100)ï¼ŒAudio Track = `Review` (S=1) |
| **é¢„æœŸ** | `/next-batch` å¿…é¡»è¿”å› Audio Gym å¡ç‰‡ï¼Œ**ç¦æ­¢**è¿”å› Speed Run å¡ç‰‡ |
| **æµ‹è¯•æ–‡ä»¶** | `actions/__tests__/multi-track.test.ts` |

#### Case B: ä¾èµ–ç†”æ–­æµ‹è¯• (Dependency Circuit Breaker)

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ“ä½œ** | è®¾ç½® `Strategy` çš„ Visual Track = `New` (ä¸è®¤è¯†) |
| **é¢„æœŸ** | æ— è®º Audio Track çŠ¶æ€å¦‚ä½•ï¼Œ**ç¦æ­¢**è¿”å› L1/L2 å¡ç‰‡ |
| **é€»è¾‘** | L0 æœªæŒæ¡ â†’ è‡ªåŠ¨ç†”æ–­é«˜çº§åœºæ™¯ |

#### Case C: æ··åˆæµæ¯”ä¾‹æµ‹è¯• (Interleaving Ratio)

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **æ“ä½œ** | æ„é€  100 ä¸ªå¾…å¤ä¹ å•è¯ (20ä¸ª L0, 50ä¸ª L1, 30ä¸ª L2) |
| **é¢„æœŸ** | å‰ 10 å¼ å¡ç‰‡ä¸­ L1 å æ¯”æœ€é«˜ï¼Œä¸”å¿…é¡»ç©¿æ’å‡ºç° (ç¦æ­¢è¿ç»­ 10 å¼ å…¨åŒç±»å‹) |

### 1.3 å·¥å…·é“¾

- **æµ‹è¯•æ¡†æ¶**: Vitest + Mock Database
- **ç°æœ‰æµ‹è¯•**: `actions/__tests__/*.test.ts`

---

## 2. ç»´åº¦äºŒï¼šå†…å®¹è´¨é‡ (Quality)

> ç›®æ ‡ï¼šç¡®ä¿ LLM æ²¡åœ¨èƒ¡è¯´å…«é“ï¼Œå¹²æ‰°é¡¹æ˜¯æœ‰æ•ˆçš„ï¼Œè§£ææ˜¯äººè¯ã€‚

### 2.1 æµ‹è¯•ç­–ç•¥ï¼šLLM-as-a-Judge (AI è£åˆ¤å‘˜)

å»ºç«‹ **Golden Evaluation Pipeline**ï¼š

```mermaid
graph LR
    A[æ‰¹é‡ç”Ÿæˆ<br/>50æ¡/åœºæ™¯] --> B[AI å®¡è®¡<br/>GPT-4o/Claude]
    B --> C{è¯„åˆ†}
    C -->|â‰¥4.2| D[é€šè¿‡]
    C -->|<4.2| E[ç¦æ­¢ä¸Šçº¿]
```

### 2.2 è¯„ä¼°æµç¨‹

#### Step 1: æ‰¹é‡ç”Ÿæˆ (Batch Generation)

```bash
npx tsx scripts/generate-eval-samples.ts --level=0 --variant=blitz --limit=50
```

- è¾“å…¥è¦†ç›–ï¼šç”Ÿè¯ã€ç†Ÿè¯ã€å¤šä¹‰è¯ã€è¡Œä¸šé»‘è¯

#### Step 2: AI å®¡è®¡ (The Auditor)

ä½¿ç”¨é«˜æ™ºå•†æ¨¡å‹åŠ è½½ **è§’è‰² Prompt**ï¼š

| è§’è‰² | è¯„ä¼°ç»´åº¦ | æ ‡å‡† |
|------|----------|------|
| **ETS Auditor** | ä¸šåŠ¡è¯­å¢ƒçœŸå®æ€§ + å¹²æ‰°é¡¹è´¨é‡ | æ‹’ç» AI å‘³é“çš„å¥å­ |
| **Anxious Engineer** | è§£é‡Šæ¸…æ™°åº¦ + 3ç§’å¯è¯» | è¯»ä¸¤éæ‰æ‡‚ â†’ Fail |
| **FSRS Pedagogy Expert** | è®°å¿†ç§‘å­¦åˆè§„æ€§ | é—´éš”é‡å¤ã€éš¾åº¦é€’è¿› |

**è¯„åˆ†ç»†é¡¹**:

| æ£€æŸ¥é¡¹ | ç±»å‹ | é˜ˆå€¼ |
|--------|------|------|
| JSON ç»“æ„ç¬¦åˆ Zod Schema | Pass/Fail | 100% |
| L2 å¥å­ä½“ç°å•†åŠ¡è¯­å¢ƒ | 1-5åˆ† | â‰¥3.5 |
| L0 å¹²æ‰°é¡¹åŒ…å« Visual Trap | Yes/No | â‰¥80% |
| è¯æ€§å˜ä½“çœŸå®å­˜åœ¨ (æ— å¹»è§‰) | Pass/Fail | 100% |

#### Step 3: å‘Šè­¦é˜ˆå€¼

- å¹³å‡åˆ†ä» 4.8 â†’ 4.2 = **ç¦æ­¢ä¸Šçº¿** (Prompt é€€åŒ–)

### 2.3 å·¥å…·é“¾

- **ç°æœ‰è„šæœ¬**: `scripts/eval-prompts.ts`
- **æŠ¥å‘Šç›®å½•**: `reports/`

---

## 3. ç»´åº¦ä¸‰ï¼šç³»ç»Ÿç¨³å®šæ€§ (Stability)

> ç›®æ ‡ï¼šç¡®ä¿æ— é™æµåœ¨ 1000 æ¬¡æ»‘åŠ¨åä¸ä¼šå´©ï¼ŒTTS ä¸ä¼šå¡ã€‚

### 3.1 æµ‹è¯•ç­–ç•¥ï¼šBot User Stress Test (æœºå™¨äººå‹åŠ›æµ‹è¯•)

ç¼–å†™æ— å¤´æµè§ˆå™¨æˆ– API è„šæœ¬ï¼Œæ¨¡æ‹Ÿæç«¯ç”¨æˆ·è¡Œä¸ºã€‚

### 3.2 åœºæ™¯ï¼šThe Binge Learner (åˆ·é¢˜ç‹‚é­”)

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **è¡Œä¸º** | è¿ç»­è¯·æ±‚ `/next-batch` 100 æ¬¡ (ç›¸å½“äº 1000 é“é¢˜) |
| **ç›‘æµ‹** | Latency P99ã€Error Rateã€Retry Success |

**æŒ‡æ ‡é˜ˆå€¼**:

| æŒ‡æ ‡ | é˜ˆå€¼ | è¯´æ˜ |
|------|------|------|
| **Latency P99** | â‰¤2s | å¦åˆ™ DB ç´¢å¼•æˆ– Redis æœ‰é—®é¢˜ |
| **Error Rate** | â‰¤1% | LLM è¶…æ—¶æˆ– JSON è§£æå¤±è´¥ |
| **Pivot Success** | 100% | å…œåº•é€»è¾‘å¿…é¡»æˆåŠŸæ•‘åœº |

### 3.3 TTS ä¸“é¡¹æµ‹è¯•

- å¹¶å‘è¯·æ±‚ 10 ä¸ª L1 å¬åŠ›é¢˜
- æ£€æŸ¥ Python TTS æœåŠ¡é˜Ÿåˆ—æ˜¯å¦å †ç§¯
- æ£€æŸ¥å†…å­˜æ³„æ¼

### 3.4 å·¥å…·é“¾

- **æ¨è**: k6 (è´Ÿè½½æµ‹è¯•) æˆ– Playwright

---

## 4. ç»ˆæå®¡è®¡ï¼šä¸Šå¸è§†è§’ Dashboard (The God View)

### 4.1 Admin Panel åŠŸèƒ½éœ€æ±‚

åœ¨ `/dashboard/admin` å¢åŠ  **Generator Inspector** é¡µé¢ï¼š

| åŠŸèƒ½ | æè¿° |
|------|------|
| **å®æ—¶æµ** | æ˜¾ç¤ºå½“å‰æ‰€æœ‰ç”¨æˆ·æ­£åœ¨ç”Ÿæˆçš„é¢˜ç›® |
| **å¿«ç…§å¯¹æ¯”** | å·¦ï¼šPrompt è¾“å…¥ / å³ï¼šLLM è¾“å‡º |
| **æ ‡æ³¨æŒ‰é’®** | ğŸ‘ / ğŸ‘ (Bad Case æ”¶é›†) |
| **Bad Case å›æµ** | ğŸ‘ è‡ªåŠ¨å­˜å…¥ Few-Shot Examples åº“ |

### 4.2 Bad Case å›æµæœºåˆ¶

```mermaid
graph LR
    A[äººå·¥æ ‡æ³¨ ğŸ‘] --> B[Bad Case åº“]
    B --> C[Few-Shot Prompt]
    C --> D[LLM ç”Ÿæˆ]
    D --> E[è´¨é‡æå‡]
```

---

## 5. å®æ–½æ¸…å•

| å±‚é¢ | æµ‹è¯•å¯¹è±¡ | æ–¹æ³• | é¢‘ç‡ | ç°çŠ¶ |
|------|----------|------|------|------|
| **Logic** | FSRS è°ƒåº¦ã€æ··åˆæµæ¯”ä¾‹ã€ä¾èµ–ç†”æ–­ | Vitest Unit Tests (Mock) | æ¯æ¬¡ Git Commit | âœ… éƒ¨åˆ†å®ç° |
| **Quality** | é¢˜ç›®è´¨é‡ã€å¹²æ‰°é¡¹é€»è¾‘ã€å¹»è§‰ | AI Auditor Script | ä¿®æ”¹ Prompt åå¿…è·‘ | âœ… å·²æœ‰è„šæœ¬ |
| **Stability** | æ¥å£å»¶è¿Ÿã€å¹¶å‘æ‰¿è½½ã€Pivot å…œåº• | k6 Stress Test | ä¸Šçº¿å‰è·‘ä¸€æ¬¡ | âš ï¸ ç¼ºå¤± |
| **Audit** | çœŸå®ç”¨æˆ·ä½“éªŒã€Bad Case | Admin Dashboard (äººå·¥çœ‹) | æ¯å¤©æŠ½çœ‹ 5 åˆ†é’Ÿ | âš ï¸ ç¼ºå¤± |

---

## 6. Gap åˆ†æä¸ä¼˜å…ˆçº§

### 6.1 å·²å®Œæˆ âœ…

| é¡¹ç›® | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| å¤šè½¨æµ‹è¯• | `actions/__tests__/multi-track.test.ts` | Done |
| FSRS çŠ¶æ€è½¬æ¢ | `actions/__tests__/record-outcome.test.ts` | Done |
| æ— é™æµé€»è¾‘ | `components/session/__tests__/session-runner.test.tsx` | Done |
| LLM è¯„ä¼°è„šæœ¬ | `scripts/eval-prompts.ts` | Done |
| æ ·æœ¬ç”Ÿæˆè„šæœ¬ | `scripts/generate-eval-samples.ts` | Done |

### 6.2 ç¼ºå¤± Gap âš ï¸

| é¡¹ç›® | ä¼˜å…ˆçº§ | å»ºè®® |
|------|--------|------|
| **ä¾èµ–ç†”æ–­æµ‹è¯•** (L0 æœªæŒæ¡ â†’ ç¦æ­¢ L1/L2) | P0 | æ–°å¢ Unit Test |
| **æ··åˆæµæ¯”ä¾‹æµ‹è¯•** (Interleaving æ ¡éªŒ) | P1 | æ–°å¢ Unit Test |
| **k6 å‹åŠ›æµ‹è¯•è„šæœ¬** | P1 | æ–°å»º `tests/load/` |
| **Admin Inspector é¡µé¢** | P2 | æ–°å¢ `/dashboard/admin/inspector` |
| **Bad Case å›æµæœºåˆ¶** | P2 | éœ€è¦ DB Schema + API |

---

## 7. ç›¸å…³æ–‡æ¡£

- [LLM è¯„ä¼°æ¶æ„](./llm-eval-architecture.md)
- [Prompt ç»“æ„ V2](./prompt-structure-v2.md)
- [æµ‹è¯•æŒ‡å—](./TESTING.md)
