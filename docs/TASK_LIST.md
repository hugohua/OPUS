# Opus Mobile (V3.3) Vibe Coding ä»»åŠ¡æ¸…å•

**ç»™ LLM çš„æ ¸å¿ƒæŒ‡ä»¤ (Master Directive):**
ä½ æ­£åœ¨æ„å»º **Opus**ï¼Œä¸€ä¸ªç”¨äºè®¤çŸ¥å¤å¥ (Level 0) çš„ **å£è¢‹èŒåœºæ¨¡æ‹Ÿå™¨**ã€‚

* **æ ¸å¿ƒæ€ç»´**: "å…ˆæ´»ä¸‹æ¥ (Survive First)"ã€‚æ¯æ—¥é™åˆ¶ 20 å¼ å¡ç‰‡ã€‚ä¸è¦åšä¸€ä¸ªâ€œé˜…è¯»å™¨â€ï¼Œè¦åšä¸€ä¸ªâ€œç‰¹è®­å™¨ (Drill)â€ã€‚
* **UI ç­–ç•¥**: "å“‘å·´" å‰ç«¯ (è´Ÿè´£å¥æ³•é«˜äº®) + "èªæ˜" åç«¯ (è´Ÿè´£ Drill Prompt ç”Ÿæˆ)ã€‚
* **æŠ€æœ¯æ ˆ**: Next.js 14 (App Router), Prisma, pgvector, Shadcn UI (Mobile), Tailwind CSSã€‚
* **æ•°æ®æº**: æ‰€æœ‰è¯æ±‡å…ƒæ•°æ®å‡é€šè¿‡ **Gemini ETL** é¢„è®¡ç®—ã€‚

---

## ğŸŸ¢ Phase 0: æ•°æ®åŸºçŸ³ (The Bedrock)

> **ç›®æ ‡**: ç¡®ä¿æ•°æ®åº“æ”¯æŒâ€œäº”ç»´â€æ¨¡æ‹Ÿï¼Œå¹¶å¤„ç†å¥½ Gemini 3 Preview çš„é™åˆ¶ã€‚

* [x] **Task 0.1: å®šç¨¿ Prisma Schema**
* **çŠ¶æ€**: å®Œæˆã€‚
* **å†…å®¹**: `Word` è¡¨åŒ…å« `word_family` (JSON), `synonyms`, `priority`ã€‚


* [x] **Task 0.2: å¯ç”¨ pgvector**
* **çŠ¶æ€**: å®Œæˆã€‚


* [x] **Task 0.3: ETL è„šæœ¬ (æ•°æ®æ¸…æ´—) **
* **æŒ‡ä»¤**: åˆ›å»º/æ›´æ–° `scripts/enrich-vocab.ts`ã€‚
* **å…³é”®æ›´æ–° (CRITICAL)**:
1. **æ¨¡å‹**: ä½¿ç”¨ `google/gemini-2.0-flash-preview` (æˆ– 3 Flash)ã€‚

* [x] **Task 0.4: æ•°æ®åº“å¡«å…… (Seed)**
* **æŒ‡ä»¤**: åˆ›å»º `prisma/seed.ts`ã€‚
* **å‘½ä»¤**: `npx prisma db seed`ã€‚


* [ ] **Task 0.5: å‘é‡åŒ–è„šæœ¬**
* **æŒ‡ä»¤**: åˆ›å»º `scripts/vectorize-vocab.ts`ã€‚
* **é€»è¾‘**: ä½¿ç”¨ OpenAI `text-embedding-3-small` ç”Ÿæˆ Embeddingã€‚




---

## ğŸŸ¡ Phase 1: ç®€æŠ¥å¼•æ“ (The Brain)

> **ç›®æ ‡**: æ„å»º **Level 0 ç‰¹è®­å¼•æ“** (ç”Ÿæˆ S-V-O å•å¥)ï¼Œæ›¿ä»£åŸå…ˆçš„é‚®ä»¶ç”Ÿæˆå™¨ã€‚

* [x] **Task 1.1: å®ç° Drill Prompt (ç‰¹è®­æç¤ºè¯) **
* **æ–‡ä»¶**: `lib/prompts/drill.ts`ã€‚
* **é€»è¾‘**: åˆ›å»º `getDrillPrompt`ã€‚å¼ºåˆ¶æ‰§è¡Œ **Level 0 çº¦æŸ**:
1. æœ€å¤§é•¿åº¦ 15 ä¸ªè¯ã€‚
2. ä¸¥æ ¼çš„ **S-V-O (ä¸»è°“å®¾)** ç»“æ„ã€‚
3. **å¼ºåˆ¶ XML æ ‡ç­¾**: `<s>`, `<v>`, `<o>`ã€‚




* [x] **Task 1.2: é‡æ„ `generateBriefing` Action **
* **çŠ¶æ€**: **éœ€è¦é‡æ„** (åˆ‡æ¢åˆ° Level 0 é€»è¾‘)ã€‚
* **æ–‡ä»¶**: `actions/generate-briefing.ts`ã€‚
* **é€»è¾‘**:
1. **æ£€æŸ¥æ¯æ—¥ç†”æ–­**: å¦‚æœ `today_count >= 20`ï¼Œç«‹å³è¿”å› `RestCard` (ä¼‘æ¯å¡)ã€‚
2. è·å– ç›®æ ‡è¯ + ä¸Šä¸‹æ–‡è¯ã€‚
3. è°ƒç”¨ LLM æ‰§è¡Œ **Drill Prompt** (Task 1.1)ã€‚
4. ä½¿ç”¨ `safe-json` è§£æç»“æœã€‚


* **è¾“å‡º JSON**:
```typescript
{
  meta: { format: "chat", level: 0 },
  segments: [
    { type: "text", content_markdown: "<s>The manager</s>..." }, // å¿…é¡»åŒ…å« XML æ ‡ç­¾
    { type: "interaction", dimension: "V", task: { ... } }
  ]
}

```




* [x] **Task 1.3: å…œåº•æ¨¡æ¿ (å®‰å…¨ç½‘)**
* **æŒ‡ä»¤**: åˆ›å»º `lib/templates/fallback-briefing.ts`ã€‚
* **é€»è¾‘**: ä¸€ä¸ªç¡¬ç¼–ç çš„ **Level 0 å¡ç‰‡** (ä¾‹å¦‚: "<s>System</s> <v>saved</v> <o>data</o>.")ã€‚
* **ç”¨é€”**: å½“ Gemini è¶…æ—¶æˆ–æŠ¥é”™æ—¶è¿”å›æ­¤å†…å®¹ã€‚



---

## ğŸ”µ Phase 2: æ”¶ä»¶ç®±ä¸ç•Œé¢ (The Body)

> **ç›®æ ‡**: "æ‹‡æŒ‡é©±åŠ¨" ç•Œé¢ + **è®¤çŸ¥è¾…åŠ©** (å¥æ³•é«˜äº® + TTS)ã€‚

* [x] **Task 2.1: "æ”¶ä»¶ç®±" ä¿¡æ¯æµ (é¦–é¡µ)**
* **æ–‡ä»¶**: `app/page.tsx`ã€‚
* **é€»è¾‘**:
1. è·å–ä¸‹ä¸€ä¸ª `Briefing`ã€‚
2. åŠ è½½æ—¶ **è‡ªåŠ¨æ’­æ”¾ TTS** (`window.speechSynthesis`)ã€‚
3. æ¸²æŸ“å¡ç‰‡ã€‚




* [x] **Task 2.2: å¥æ³•é«˜äº®æ¸²æŸ“å™¨ *[å·²æ›´æ–°]* **
* **æ–‡ä»¶**: `components/briefing/syntax-text.tsx` (æ›¿ä»£ markdown-renderer)ã€‚
* **é€»è¾‘**: è§£æ `<s>`, `<v>`, `<o>` æ ‡ç­¾ã€‚
* **æ ·å¼**:
* `<s>`: ç»¿è‰²ä¸‹åˆ’çº¿ã€‚
* `<v>`: **çº¢è‰²ç²—ä½“**ã€‚
* `<o>`: è“è‰²èƒŒæ™¯ã€‚




* [x] **Task 2.3: ç»Ÿä¸€äº¤äº’ç»„ä»¶**
* **æ–‡ä»¶**: `components/briefing/interaction-zone.tsx`ã€‚
* **çº¦æŸ**: ä½äºå±å¹•åº•éƒ¨ 30% åŒºåŸŸã€‚
* **ç»„ä»¶**:
* `SwipeChoice`: ç”¨äº V ç»´åº¦ (å·¦å³äºŒé€‰ä¸€) - **Level 0 æ ¸å¿ƒ**ã€‚
* `FlipCard`: èƒŒé¢æ˜¾ç¤ºå…¨å¥ä¸­æ–‡ç¿»è¯‘ã€‚





---

## ğŸŸ£ Phase 3: æ¨¡æ‹Ÿå¾ªç¯ (The Soul)

> **ç›®æ ‡**: è®°å½•è¿›åº¦å¹¶å¼ºåˆ¶æ‰§è¡Œ **æ¯æ—¥ç†”æ–­**ã€‚

* [ ] **Task 3.1: è®°å½•ç»“æœ Action *[å·²æ›´æ–°]* **
* **æ–‡ä»¶**: `actions/record-outcome.ts`ã€‚
* **é€»è¾‘**:
1. æ›´æ–° `UserWordProgress`ã€‚
2. å¢åŠ  `today_count` (ä»Šæ—¥å®Œæˆæ•°)ã€‚
3. **è¿”å›**: `daily_cap_reached: boolean`ã€‚




* [ ] **Task 3.2: ä¼‘æ¯å¡ (Rest Card) UI *[æ–°å¢]* **
* **UI**: ä¸€å¼ å¹³é™çš„ã€ä¸å¯äº¤äº’çš„å¡ç‰‡ã€‚
* **æ–‡æ¡ˆ**: "You survived today. See you tomorrow." (ä»Šæ—¥å·²å­˜æ´»ï¼Œæ˜æ—¥å†æˆ˜)ã€‚
* **è§¦å‘**: å½“ `daily_cap_reached` ä¸º true æ—¶æ˜¾ç¤ºã€‚



---

## âš« Phase 4: æ‰©å±• (åç»­è§„åˆ’)

* Task 4.1: X ç»´åº¦ (é€»è¾‘æ’å…¥é¢˜)
* Task 4.2: Level 1 å‡çº§ (é‚®ä»¶ç”Ÿæˆ)
* Task 4.3: Auth é›†æˆ (ç™»å½•é‰´æƒ)